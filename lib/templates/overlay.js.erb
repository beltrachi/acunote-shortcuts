<%= render "preface.js" %>


/*
 *  ===========================================================
 *  Acunote Shortcuts: The Library
 *  Copyright (c) 2007-2008 Pluron, Inc.
 *  ===========================================================
 */
function ShortcutsSource() {
<%= indent acunote_shortcuts %>
}

<% sites.each do |site| %>
<%= site[:code] %>
<% end %>

/*
 *  ===========================================================
 *  Shortcuts Library: Supported Sites
 *  This script matches site URL against the
 *  property name and gets the source of the function
 *  specified as property value.
 *  ===========================================================
 */
var SupportedSites = {
    'news.ycombinator.com/': YCombinatorSource,
    'news.ycombinator.org/': YCombinatorSource,
    'reddit.com/':           RedditSource,
    'digg.com/':             DiggSource,
    'example.com/':          DummySource
}




/*
 *  ===========================================================
 *  Shortcuts Library: Loader
 *  Copyright (c) 2008 Pluron, Inc.
 *  ===========================================================
 */
function getSource(func) {
    var js = func.toString();
    var i = js.indexOf('{');
    js = js.substr(i+1, js.length - i - 2);
    return js;
}

var acunoteShortcuts = {
  init: function() {
    var appcontent = document.getElementById("appcontent");  
    if(appcontent) appcontent.addEventListener("DOMContentLoaded", this.onPageLoad, true);
  },

  onPageLoad: function(aEvent) {
    var doc = aEvent.originalTarget; 
    for (site in SupportedSites) {
        if (typeof(site) != 'string')
            continue;
        if (doc.location.href.match(site)) {
            var s = doc.createElement('script');
            var source = getSource(ShortcutsSource);
            source += getSource(SupportedSites[site]);
            var text = doc.createTextNode(source);
            s.appendChild(text);
            doc.getElementsByTagName('head')[0].appendChild(s);
            doc.defaultView.setTimeout("Cursor.init()", 1);
            break;
        }
    }
  }
}

window.addEventListener("load", function() { acunoteShortcuts.init(); }, false);

